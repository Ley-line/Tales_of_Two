#textdomain wesnoth-tales_of_two
[scenario]
	current_time=3
	description=""
	id="13_Cold_as_ice"
	map_data="{~add-ons/Tales_of_Two/maps/13_Cold_as_ice.map}"
	name="13_Cold_as_ice"
	next_scenario=null

	random_start_time=no
	turns=unlimited
	experience_modifier={QUANTITY experience_modifier 75 90 105}
	victory_when_enemies_defeated=no
	carryover_percentage=0

	{TOT_DEATH_EVENTS}
	{WINTER_SCHEDULE}
	{TOT_ABILITIES}
	{TOT_MUSIC_JOURNEY2}

	{TOT_ITEM_GOLD_CHEST 1 37 50}
	{TOT_ITEM_POTION_EXPERIENCE 23 39 2}
	{TOT_ITEM_POTION_LONG_WINTER 26 31 3}

	[item]
		x,y=10,39
		image=scenery/mountain-door.png
	[/item]

	[side]
		{TOT_SIDE_KALEY}
	    recruit=Peasant,Bowman,Cavalryman,Fencer,Heavy Infantryman,Horseman,Mage,Spearman,Elvish Scout,Elvish Shaman,Elvish Fighter,Elvish Archer
		facing=ne
		gold=0
		{QUANTITY income 6 3 -2}
	    village_gold=7
		fog=no
	[/side]
	
	[side]
		{TOT_SIDE_NOUR}
		recruit=Peasant,Bowman,Cavalryman,Fencer,Heavy Infantryman,Horseman,Mage,Spearman,Elvish Scout,Elvish Shaman,Elvish Fighter,Elvish Archer
		facing=ne
		gold=0
		{QUANTITY income 6 3 -2}
	    village_gold=7
		fog=no
	[/side]

	[side]
		{TOT_SIDE_IDLE}
	[/side]

	[side]
		{TOT_SIDE_WILD}
	[/side]

	[side]
        recruit=Dwarvish Thunderer,Dwarvish Steelclad,Dwarvish Stalwart,Dwarvish Ulfserker,Dwarvish Scout,Dwarvish Lord
		controller="ai"
		fog=no
		shroud=no
		hidden=no
		gold=0
		income=-2
		no_leader=no
		share_vision="all"
		side=5
		team_name=Dwarves
		user_team_name=Dwarves
		village_gold=2
	[/side]

	[side]
        recruit=Troll Whelp,Troll,Troll Warrior,Troll Rocklobber,Troll Hero
		controller="ai"
		fog=no
		shroud=no
		hidden=no
		gold=0
		income=-2
		no_leader=no
		share_vision="all"
		side=6
		team_name=Trolls
		user_team_name=Trolls
		village_gold=2
	[/side]

	[side]
        recruit=Dread Bones,Dread Archer,Soul Seeker
		controller="ai"
		fog=no
		shroud=no
		hidden=no
		gold=0
		income=-2
		no_leader=no
		share_vision="all"
		side=7
		team_name=Undead
		user_team_name=Undead
		village_gold=2
	[/side]

	[side]
        recruit=Walking Corpse,Soulless,Ghost,Wraith,Skeleton,Revenant,Skeleton Archer,Bone Shooter
		controller="ai"
		fog=no
		shroud=no
		hidden=no
		{QUANTITY gold 200 275 335}
		income=-2
		no_leader=no
		share_vision="all"
		side=8
		team_name=Undead
		user_team_name=Undead2
		village_gold=1
	[/side]

    [event]
        name=prestart

		[terrain]
			x,y=1-43,10
			terrain="^Xo"
			layer=overlay
		[/terrain]

		[recall]
			id=Middyn
		[/recall]
		[recall]
			id=Dalon
		[/recall]

	    [objectives]
	        [objective]
	            description= _ "Follow the path and look around for supplies"
	            condition=win
	        [/objective]
			{TOT_DEATH_OBJECTIVE}
	        [objective]
	            description= _ "Death of Middyn or Dalon"
	            condition=lose
	        [/objective]
	    [/objectives]
    [/event]

    [event]
        name=start
		{SAY Kaley "Brrrr, that's cold!"}
        {SAY Nour "It seems we're stranded in the north.."}
        {SAY Middyn "Great, does the dwarf know where we are?"}
        {SAY Dalon "Errr.. I believe quite far from home. It took de buggers quite a while ta take us here."}
        {SAY Kaley "Let's follow the path and look around. Hopefully we can head south soon."}
#ifdef HARD
		[unit]
			type="Yeti"
			name="Mother Yeti"
			id=Yeti1
			side=3
			x,y=9,33
			{TOT_BOSS 142}
		[/unit]
#endif
#ifndef EASY
		[unit]
			type="Yeti"
			name="Inexperienced Yeti"
			id=Yeti2
			level=1
			side=3
			x,y=9,34
			{ADD_EFFECT (
				[effect]
					apply_to=attack
					range=melee
					increase_damage=-17
				[/effect]
				[effect]
					apply_to=hitpoints
					increase_total=-60%
				[/effect]
			)}
		[/unit]
		[unit]
			type="Yeti"
			name="Inexperienced Yeti"
			id=Yeti3
			level=1
			side=3
			x,y=8,32
			{ADD_EFFECT (
				[effect]
					apply_to=attack
					range=melee
					increase_damage=-17
				[/effect]
				[effect]
					apply_to=hitpoints
					increase_total=-60%
				[/effect]
			)}
		[/unit]
		[unit]
			type="Yeti"
			name="Inexperienced Yeti"
			id=Yeti4
			level=1
			side=3
			x,y=8,33
			{ADD_EFFECT (
				[effect]
					apply_to=attack
					range=melee
					increase_damage=-17
				[/effect]
				[effect]
					apply_to=hitpoints
					increase_total=-60%
				[/effect]
			)}
		[/unit]
#endif
		[unit]
#ifdef EASY
			type="Troll"
#endif
#ifdef NORMAL
			type="Troll Warrior"
#endif
#ifdef HARD
			type="Great Troll"
#endif
			id=Troll1
			side=4
			x,y=15,39
		[/unit]
		[unit]
#ifdef EASY
			type="Troll"
#endif
#ifdef NORMAL
			type="Troll Warrior"
#endif
#ifdef HARD
			type="Great Troll"
#endif
			id=Troll2
			side=4
			x,y=6,40
		[/unit]

		{SAY Troll1 "The dwarf has escaped and brought allies! The master will not tolerate this."}
		{SAY Nour "Trolls.."}
    [/event]

	[event]
		{TOT_SIGHTED Yeti1,Yeti2,Yeti3,Yeti4 4}
		{SAY unit "Raaaaaaaarghhh!"}
		{SAY second_unit "Yeti ahead!"}
	[/event]

    [event]
        name=moveto
        [filter]
            side=1,2
            x,y=20,31
        [/filter]
		{SAY unit "Elf in sight, at the village!"}
		[unit]
			side=$unit.side
			type="Elvish Ranger"
			name=Timeon
			id=Elf
			x,y=20,31
		[/unit]
		{SAY Elf "You shouldn't have come here."}
		{SAY Kaley "I'm afraid we had no choice."}
		{SAY Nour "What are you doing here? This place looks raided and abandoned."}
		{SAY Elf "Most of us are dead, and there is nowhere to go."}
		{SAY Kaley "What about the north?"}
		{SAY Elf "The north is about to be at war.. It's no longer safe there."}
		{SAY Kaley "At war!?"}
		{SAY Elf "You're not considering to join the war are you?"}
		{SAY Nour "It's the only way out of here."}
		{SAY Kaley "What do you know about this 'war'?"}
		{SAY Elf "The dwarves want their lands back, and the trolls want land because they have nowhere else to go. The orcs drove them away, took prisoners, and murdered many of both sides. Now they seek to destroy eachother, oblivious to the darkness it will cause."}
		{SAY Nour "What if we turn the dwarves and trolls against the orcs?"}
		{SAY Elf "I won't say it won't work, but it will be very tricky.."}
		{SAY Nour "Then let us try."}
		{SAY Kaley "Come with us!"}
		{SAY Elf "I won't be much help, but any chance of getting out of here is better than none. Very well."}
    [/event]

    [event]
        name=moveto
        [filter]
            side=1,2
            x,y=10,31
        [/filter]
		{SAY unit "Nobody appears to be at home."}
    [/event]

    [event]
        name=moveto
        [filter]
            side=1,2
            x,y=19,27
        [/filter]
		{SAY unit "Anyone inside!?"}
		[delay]
			time=500
		[/delay]
		{SAY unit "I guess not. The inside of this village is in ruins.."}
    [/event]

    [event]
        name=moveto
        [filter]
            side=1,2
            x=1-43
			y=1-25
        [/filter]
		[unit]
			type="Dwarvish Hero tot"
			name="Hemrak"
			id=DwarfLeader
			side=5
			x,y=5,20
			max_hitpoints=125
			max_experience=300
			max_moves=0
		[/unit]
		[remove_shroud]
			[filter_side]
				side=1,2
			[/filter_side]
			x,y=5,20
			radius=2
		[/remove_shroud]
		[scroll_to]
			x,y=5,20
		[/scroll_to]
		{SAY DwarfLeader "Haven't ye trolls had enough bashing on yer heads!?"}
		[delay]
			time=500
		[/delay]
		[unit]
			type="Siege Troll tot"
			name="Alwan"
			id=TrollLeader
			side=6
			x,y=23,16
			max_hitpoints=125
			max_experience=300
			max_moves=0
		[/unit]
		[remove_shroud]
			[filter_side]
				side=1,2
			[/filter_side]
			x,y=23,16
			radius=2
		[/remove_shroud]
		{SAY TrollLeader "Dwarf, I will have your head on a spike!"}
		[scroll_to]
			x,y=23,16
		[/scroll_to]
		{SAY Nour "Stop this madness!"}
		{SAY Kaley "You have to listen to us, there is a bigger threat than just the clash of trolls and dwarves!"}
		{NARRATE "The roaring of the trolls and loud battle cries of the dwarves makes even the loudest screams of humans seem like whispers.."}
		{SAY Middyn "We'll have to get up close with the leaders."}
		{SAY Kaley "Up close, have you gone insane?"}
		{SAY Dalon "He's right lass. I can try to convince the dwarves, but I don't know how you're going to even try to talk sense into a walking rock."}
		{SAY Nour "We'll have to improvise."}
		{SAY Kaley "Right.. I suppose we have no choice."}

#ifdef EASY
		[modify_side]
			side=5
			gold=150
		[/modify_side]
		[modify_side]
			side=6
			gold=150
		[/modify_side]
#endif
#ifdef NORMAL
		[modify_side]
			side=5
			gold=220
			income=20
		[/modify_side]
		[modify_side]
			side=6
			gold=220
			income=20
		[/modify_side]
#endif
#ifdef HARD
		[modify_side]
			side=5
			gold=320
			income=30
		[/modify_side]
		[modify_side]
			side=6
			gold=320
			income=30
		[/modify_side]
#endif

		{GENERIC_UNIT 6 (Troll Warrior) 15 18}
		{GENERIC_UNIT 6 (Troll) 15 17}
		{GENERIC_UNIT 6 (Troll) 15 19}
		{GENERIC_UNIT 6 (Troll) 17 19}
		{GENERIC_UNIT 6 (Troll) 25 17}
		{GENERIC_UNIT 6 (Troll Whelp) 23 14}
		{GENERIC_UNIT 5 (Dwarvish Steelclad) 13 18}
		{GENERIC_UNIT 5 (Dwarvish Steelclad) 13 19}
		{GENERIC_UNIT 5 (Dwarvish Steelclad) 13 20}
		{GENERIC_UNIT 5 (Dwarvish Lord) 12 19}
		{GENERIC_UNIT 5 (Dwarvish Dragonguard) 11 21}

	    [objectives]
	        [objective]
	            description= _ "Reach the dwarvish leader with Dalon."
	            condition=win
	        [/objective]
	        [objective]
	            description= _ "Reach the troll leader with Middyn, or one of the leaders."
	            condition=win
	        [/objective]
			{TOT_DEATH_OBJECTIVE}
	        [objective]
	            description= _ "Death of Middyn or Dalon"
	            condition=lose
	        [/objective]
	        [objective]
	            description= _ "Death of the dwarvish or troll leaders"
	            condition=lose
	        [/objective]
	    [/objectives]
    [/event]

	[event]
		name=die
		[filter]
			id=DwarfLeader,TrollLeader
		[/filter]
		{SAY Nour "No!"}
		[endlevel]
			result=defeat
		[/endlevel]
	[/event]

    [event]
        name=moveto
        [filter]
            side=1,2
			id=Dalon,Kaley
			[filter_adjacent]
				id=DwarfLeader
			[/filter_adjacent]
        [/filter]
		{SAY DwarfLeader "How dare y...! You're a dwarf!?"}
		{SAY Dalon "My apologies laddy, but there was no other way to reach out to you. We're with ye, but this battle against the Trolls needs to stop."}
		[set_variable]
			name=talkedToDwarves
			value=true
		[/set_variable]
		[modify_side]
			side=5
			team_name=Friendly
		[/modify_side]
		[if]
			[variable]
				name=talkedToTrolls
				boolean_equals=true
			[/variable]
			[then]
				[fire_event]
					name=engageUndead
				[/fire_event]
			[/then]
			[else]
				{SAY DwarfLeader "That rock wants my head on a spike, and you want me to stop!? Don't get in my way again."}
				{SAY unit "Damn, we'll have to talk to the trolls as well."}
			[/else]
		[/if]
    [/event]

    [event]
        name=moveto
        [filter]
            side=1,2
			id=Kaley,Nour,Middyn
			[filter_adjacent]
				id=TrollLeader
			[/filter_adjacent]
        [/filter]
		{SAY TrollLeader "Little dwarf, you die!"}
		{THUNDER (
			{SAY unit "If you don't listen to reason, your foolish decision will end badly!"}
		)}
		{SAY TrollLeader "You not dwarf, what are you then?"}
		{SAY unit "We're humans from the Mages guild. Stop this madness at once!"}
		[set_variable]
			name=talkedToTrolls
			value=true
		[/set_variable]
		[modify_side]
			side=6
			team_name=Friendly
		[/modify_side]
		[if]
			[variable]
				name=talkedToDwarves
				boolean_equals=true
			[/variable]
			[then]
				[fire_event]
					name=engageUndead
				[/fire_event]
			[/then]
			[else]
				{SAY TrollLeader "Not before that dwarf goes back to his hole he came from! Don't get in my way again, or you're next."}
				{SAY unit "Damn, we'll have to talk to the dwarves as well."}
			[/else]
		[/if]
    [/event]

    [event]
        name=attack
        [filter]
            side=5
        [/filter]
		[filter_second]
			side=6
		[/filter_second]
		{SAY unit "Taste my axe, troll filth!"}
    [/event]

    [event]
        name=attack
        [filter]
            side=6
        [/filter]
		[filter_second]
			side=5
		[/filter_second]
		{SAY unit "Raaaaargh!"}
    [/event]

	# DEBUG
	[event]
		name=moveto
		[filter]
			x,y=12,39
		[/filter]
			[fire_event]
				name=engageUndead
			[/fire_event]
	[/event]

	[event]
		name=engageUndead
		{SAY Kaley "Look!"}
		[terrain]
			x,y=1-43,10
			terrain="^"
			layer=overlay
		[/terrain]
		[remove_shroud]
			x,y=13,14
			radius=2
		[/remove_shroud]

		[modify_side]
			side=7
			{QUANTITY gold 300 450 600}
			{QUANTITY income 20 35 50}
		[/modify_side]

		[unit]
			canrecruit=yes
			type="Dread Bones"
			id=undeadScout
			side=7
			facing=sw
			x,y=12,14
			{IS_LOYAL}
		[/unit]
		[unit]
			canrecruit=yes
			type="Dread Bones"
			side=7
			facing=sw
			x,y=14,14
			{IS_LOYAL}
		[/unit]
		[unit]
			canrecruit=yes
			type="Dread Bones"
			side=7
			facing=sw
			x,y=13,15
			{IS_LOYAL}
		[/unit]
		[unit]
			canrecruit=yes
			type="Dread Bones"
			side=7
			facing=sw
			x,y=12,13
			{IS_LOYAL}
		[/unit]
		[unit]
			canrecruit=yes
			type="Dread Bones"
			side=7
			facing=sw
			x,y=13,13
			{IS_LOYAL}
		[/unit]
		[unit]
			canrecruit=yes
			type="Dread Bones"
			side=7
			facing=sw
			x,y=14,13
			{IS_LOYAL}
		[/unit]

		[unit]
			type="Sorcerer of the Dead"
			name=Shady Sorceress
			id=undeadHero
			gender=female
			facing=sw
			side=7
			x,y=13,14
			{TOT_BOSS 100}
			{IS_HERO}
		[/unit]

		[unit]
			canrecruit=yes
			type="Lich"
			facing=sw
			id=undead8_1
			side=8
			x,y=9,8
			{TOT_BOSS 75}
			{IS_HERO}
		[/unit]
		[unit]
			type="Demilich tot"
			facing=sw
			id=undead8_2
			side=8
			x,y=11,6
			{TOT_BOSS 125}
		[/unit]
		[unit]
			type="Death Knight"
			facing=sw
			id=undead8_3
			side=8
			x,y=13,4
			{TOT_BOSS 75}
			{IS_HERO}
		[/unit]

		{SAY undeadScout "Hehh! Your doom is at hand!"}
		{SAY TrollLeader "Bones without meat, you make mistake to interfere."}
		{SAY DwarfLeader "The hordes of hell are upon us, let them taste our steel!"}
		{SAY undeadHero "Ignore their weak threats, kill them all!"}
		{SAY Nour "I sense dark arcane magic eminating from the abberations. We should be extra careful."}
		{SAY Middyn "The sorceress doesn't look human either. What on earth is going on?"}
		{SAY Kaley "They might be experiments, or related to the ones we saw from before."}
		{SAY Dalon "That is not good news laddies. We should find their weakness, not all weapons can be as effective if what you say is true."}

	    [objectives]
	        [objective]
	            description= _ "Defeat the undead incursion"
	            condition=win
	        [/objective]
			{TOT_DEATH_OBJECTIVE}
	        [objective]
	            description= _ "Death of Middyn or Dalon"
	            condition=lose
	        [/objective]
	        [objective]
	            description= _ "Death of the dwarvish or troll leaders"
	            condition=lose
	        [/objective]
	    [/objectives]
	[/event]

	[event]
		name=last breath
		[filter]
			id=undead8_1,undead8_2,undead8_3
		[/filter]
		{SAY unit "We... Were... Forced..."}
	[/event]

    [event]
        name=moveto
        [filter]
            side=1,2
            x,y=32-43,27-43
        [/filter]
		{SAY Nour "A road to the south, at last!"}
		[endlevel]
			result=victory
		[/endlevel]
    [/event]
[/scenario]