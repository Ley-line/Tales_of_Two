#textdomain wesnoth-tales_of_two
[scenario]
	id="15_The_stronghold"
	map_data="{~add-ons/Tales_of_Two/maps/15_The_stronghold.map}"
	name="15_The_stronghold"
	next_scenario=16_Warm_welcome

	turns=unlimited
	{QUANTITY experience_modifier 85 100 110}
	victory_when_enemies_defeated=no
	carryover_percentage=20
	carryover_add=true

	{TOT_DEATH_EVENTS}
	{UNDERGROUND}
	{TOT_ABILITIES}
	{TOT_MUSIC_CAVE}

	{RECALL_ENOR 11 46}

	# Place items on the map
    {PLACE_ITEM 09 40 scenery/rocks-1.png}
    {PLACE_ITEM 22 38 scenery/rocks-1.png}
    {PLACE_ITEM 03 35 scenery/rocks-1.png}
    {PLACE_ITEM 02 14 scenery/rocks-1.png}
    {PLACE_ITEM 01 16 scenery/rocks-1.png}
    {PLACE_ITEM 11 01 scenery/rocks-1.png}
    {PLACE_ITEM 29 08 scenery/rocks-1.png}
    {PLACE_ITEM 21 16 scenery/rocks-1.png}
    {PLACE_ITEM 34 25 scenery/rocks-1.png}
    {PLACE_ITEM 24 27 scenery/rocks-1.png}
    {PLACE_ITEM 27 25 scenery/rocks-1.png}
    {PLACE_ITEM 30 15 scenery/rocks-1.png}

    {PLACE_ITEM 09 45 scenery/rocks-2.png}
    {PLACE_ITEM 03 43 scenery/rocks-2.png}
    {PLACE_ITEM 10 40 scenery/rocks-2.png}
    {PLACE_ITEM 13 37 scenery/rocks-2.png}
    {PLACE_ITEM 01 35 scenery/rocks-2.png}
    {PLACE_ITEM 20 30 scenery/rocks-2.png}
    {PLACE_ITEM 11 23 scenery/rocks-2.png}
    {PLACE_ITEM 03 14 scenery/rocks-2.png}
    {PLACE_ITEM 02 16 scenery/rocks-2.png}
    {PLACE_ITEM 06 09 scenery/rocks-2.png}
    {PLACE_ITEM 11 02 scenery/rocks-2.png}
    {PLACE_ITEM 17 03 scenery/rocks-2.png}
    {PLACE_ITEM 12 05 scenery/rocks-2.png}
    {PLACE_ITEM 24 09 scenery/rocks-2.png}
    {PLACE_ITEM 26 09 scenery/rocks-2.png}
    {PLACE_ITEM 21 20 scenery/rocks-2.png}
    {PLACE_ITEM 29 24 scenery/rocks-2.png}
    {PLACE_ITEM 33 21 scenery/rocks-2.png}
    {PLACE_ITEM 32 15 scenery/rocks-2.png}
    {PLACE_ITEM 15 28 scenery/rocks-2.png}
    {PLACE_ITEM 06 19 scenery/rocks-2.png}

    {PLACE_ITEM 10 02 scenery/rocks-3.png}
    {PLACE_ITEM 12 01 scenery/rocks-3.png}
    {PLACE_ITEM 15 06 scenery/rocks-3.png}
    {PLACE_ITEM 09 04 scenery/rocks-3.png}
    {PLACE_ITEM 01 15 scenery/rocks-3.png}
    {PLACE_ITEM 03 15 scenery/rocks-3.png}
    {PLACE_ITEM 24 16 scenery/rocks-3.png}
    {PLACE_ITEM 06 23 scenery/rocks-3.png}
    {PLACE_ITEM 04 35 scenery/rocks-3.png}
    {PLACE_ITEM 05 40 scenery/rocks-3.png}
    {PLACE_ITEM 01 35 scenery/rocks-3.png}
    {PLACE_ITEM 07 42 scenery/rocks-3.png}
    {PLACE_ITEM 01 34 scenery/rocks-3.png}
    {PLACE_ITEM 10 33 scenery/rocks-3.png}
    {PLACE_ITEM 11 37 scenery/rocks-3.png}
    {PLACE_ITEM 10 25 scenery/rocks-3.png}
    {PLACE_ITEM 08 07 scenery/rocks-3.png}

	{PLACE_ITEM 27 30 scenery/rocks-4.png}
	{PLACE_ITEM 33 29 scenery/rocks-4.png}
	{PLACE_ITEM 15 14 scenery/rocks-4.png}
	{PLACE_ITEM 02 15 scenery/rocks-4.png}
	{PLACE_ITEM 07 06 scenery/rocks-4.png}
	{PLACE_ITEM 18 02 scenery/rocks-4.png}
	{PLACE_ITEM 29 09 scenery/rocks-4.png}
	{PLACE_ITEM 30 14 scenery/rocks-4.png}
	{PLACE_ITEM 28 16 scenery/rocks-4.png}
	{PLACE_ITEM 24 17 scenery/rocks-4.png}
	{PLACE_ITEM 14 14 scenery/rocks-4.png}
	{PLACE_ITEM 36 15 scenery/rocks-4.png}
	{PLACE_ITEM 08 19 scenery/rocks-4.png}
	{PLACE_ITEM 02 36 scenery/rocks-4.png}

	# Yes, things other than rocks are here too!
	{PLACE_ITEM 11 31 scenery/brazier-fallen.png}
	{PLACE_ITEM 09 23 scenery/mine-cart-ores-se-nw.png}
	{PLACE_ITEM 05 14 scenery/mine-cart-ores-ne-sw.png}
	{PLACE_ITEM 18 05 scenery/mine-cart-empty-se-nw.png}
	{PLACE_ITEM 18 03 scenery/mine-cart-ores-ne-sw.png}
	{PLACE_ITEM 21 32 scenery/mine-cart-ores-se-nw.png}
	{PLACE_ITEM 29 29 scenery/mine-cart-empty-se-nw.png}
	{PLACE_ITEM 34 32 scenery/icepack-1.png}
	{PLACE_ITEM 32 32 scenery/icepack-1.png}
	{PLACE_ITEM 38 34 scenery/icepack-1.png}
	{PLACE_ITEM 41 36 scenery/icepack-1.png}

	# Interactables
	{TOT_ITEM_GOLD_MINECART_NW 21 33 175}
	{TOT_ITEM_GOLD_MINECART_NE 17 04 125}
	{TOT_ITEM_GOLD 7 39 40}
	{TOT_ITEM_GOLD 23 44 25}
	{TOT_ITEM_GOLD 29 26 32}
	{TOT_ITEM_POTION_ENERGY 4 36 item1}
	{TOT_ITEM_POTION_LONG_WINTER 38 32 item2}
	{TOT_ITEM_TRIDENT_SEA 18 18 item3}
	{TOT_ITEM_RING_OF_REGENERATION_LESSER 38 29 item4}

	# Stand-by units
	{UNIT_STANDBY_COMPLEX 4 (Giant Spider) 16 4 (id=spider) (
		{SAY spider "Ssssskkkk!"}
		{SAY second_unit "Giant spider ahead! Be careful everyone!"}
	)}
	{UNIT_STANDBY_COMPLEX 4 (Soulless) 34 14 (
		name="Fallen Lordguard"
		variation=dwarf
		{IS_HERO}
		{TOT_BOSS_STRONG}
	) (
        [fire_event]
            name=spottedLordguard
            [primary_unit]
                id=$unit.id
            [/primary_unit]
        [/fire_event]
	)}
	{UNIT_STANDBY_COMPLEX 4 (Soulless) 35 16 (
		name="Fallen Lordguard"
		variation=dwarf
		{IS_HERO}
		{TOT_BOSS_STRONG}
	) (
        [fire_event]
            name=spottedLordguard
            [primary_unit]
                id=$unit.id
            [/primary_unit]
        [/fire_event]
	)}
	{UNIT_STANDBY_COMPLEX 4 (Soulless) 34 17 (
		name="Fallen Lordguard"
		variation=dwarf
		{IS_HERO}
		{TOT_BOSS_STRONG}
	) (
        [fire_event]
            name=spottedLordguard
            [primary_unit]
                id=$unit.id
            [/primary_unit]
        [/fire_event]
	)}

	{UNIT_STANDBY_COMPLEX 4 (Tentacle of the Deep) 24 10 (max_moves=0) ()}
	{UNIT_STANDBY_COMPLEX 4 (Tentacle of the Deep) 20 11 (max_moves=0) ()}
	{UNIT_STANDBY_COMPLEX 4 (Tentacle of the Deep) 14 17 (max_moves=0) ()}
	{UNIT_STANDBY_COMPLEX 4 (Tentacle of the Deep) 18 17 (max_moves=0) ()}
	{UNIT_STANDBY_COMPLEX 4 (Tentacle of the Deep) 20 18 (max_moves=0) ()}
	{UNIT_STANDBY_COMPLEX 4 (Tentacle of the Deep) 16 18 (max_moves=0) ()}
	{UNIT_STANDBY_COMPLEX 4 (Tentacle of the Deep) 24 18 (max_moves=0) ()}
	{UNIT_STANDBY_COMPLEX 4 (Tentacle of the Deep) 19 19 (max_moves=0) ()}
	{UNIT_STANDBY_COMPLEX 4 (Tentacle of the Deep) 17 20 (max_moves=0) ()}
#ifndef EASY
	{UNIT_STANDBY_COMPLEX 4 (Tentacle of the Deep) 19 16 (max_moves=0) ()}
	{UNIT_STANDBY_COMPLEX 4 (Tentacle of the Deep) 22 18 (max_moves=0) ()}
	{UNIT_STANDBY_COMPLEX 4 (Tentacle of the Deep) 15 16 (max_moves=0) ()}
	{UNIT_STANDBY_COMPLEX 4 (Tentacle of the Deep) 17 14 (max_moves=0) ()}
	{UNIT_STANDBY_COMPLEX 4 (Tentacle of the Deep) 21 10 (max_moves=0) ()}
	{UNIT_STANDBY_COMPLEX 4 (Tentacle of the Deep) 19 22 (max_moves=0) ()}
#endif

#ifdef EASY
	{UNIT_STANDBY 4 (Skeleton) 22 22}
	{UNIT_STANDBY 4 (Skeleton Archer) 27 23}
	{UNIT_STANDBY 4 (Vampire Bat) 23 25}
	{UNIT_STANDBY 4 (Ghost) 27 25}
	{UNIT_STANDBY 4 (Skeleton Archer) 24 27}
	{UNIT_STANDBY 4 (Ghoul) 27 28}
	{UNIT_STANDBY 4 (Vampire Bat) 27 30}
	{UNIT_STANDBY 4 (Ghost) 31 29}
	{UNIT_STANDBY 4 (Ghoul) 32 27}
	{UNIT_STANDBY 4 (Vampire Bat) 32 31}
	{UNIT_STANDBY 4 (Skeleton) 34 25}
	{UNIT_STANDBY 4 (Skeleton Archer) 29 26}
	{UNIT_STANDBY 4 (Vampire Bat) 28 20}
	{UNIT_STANDBY 4 (Ghoul) 34 20}
#endif
#ifdef NORMAL
	{UNIT_STANDBY 4 (Revenant) 22 22}
	{UNIT_STANDBY 4 (Bone Shooter) 27 23}
	{UNIT_STANDBY 4 (Blood Bat) 23 25}
	{UNIT_STANDBY 4 (Wraith) 27 25}
	{UNIT_STANDBY 4 (Skeleton Archer) 24 27}
	{UNIT_STANDBY 4 (Ghoul) 27 28}
	{UNIT_STANDBY 4 (Blood Bat) 27 30}
	{UNIT_STANDBY 4 (Ghost) 31 29}
	{UNIT_STANDBY 4 (Ghast) 32 27}
	{UNIT_STANDBY 4 (Blood Bat) 32 31}
	{UNIT_STANDBY 4 (Revenant) 34 25}
	{UNIT_STANDBY 4 (Bone Shooter) 29 26}
	{UNIT_STANDBY 4 (Vampire Bat) 28 20}
	{UNIT_STANDBY 4 (Ghast) 34 20}
#endif
#ifdef HARD
	{UNIT_STANDBY 4 (Draug) 22 22}
	{UNIT_STANDBY 4 (Banebow) 27 23}
	{UNIT_STANDBY 4 (Blood Bat) 23 25}
	{UNIT_STANDBY 4 (Spectre) 27 25}
	{UNIT_STANDBY 4 (Bone Shooter) 24 27}
	{UNIT_STANDBY 4 (Necrophage) 27 28}
	{UNIT_STANDBY 4 (Blood Bat) 27 30}
	{UNIT_STANDBY 4 (Wraith) 31 29}
	{UNIT_STANDBY 4 (Ghast) 32 27}
	{UNIT_STANDBY 4 (Blood Bat) 32 31}
	{UNIT_STANDBY 4 (Revenant) 34 25}
	{UNIT_STANDBY 4 (Bone Shooter) 29 26}
	{UNIT_STANDBY 4 (Dread Bat) 28 20}
	{UNIT_STANDBY 4 (Necrophage) 34 20}
#endif

	[side]
		{TOT_SIDE_LEYLA}
	    recruit=Bowman,Cavalryman,Fencer,Heavy Infantryman,Horseman,Mage,Spearman,Elvish Scout,Elvish Shaman,Elvish Fighter,Elvish Archer,Sword Mage tot,Red Mage,White Mage
		facing=ne
		{QUANTITY gold 150 80 50}
		{QUANTITY income 9 4 1}
	    village_gold=4
		fog=no
	[/side]
	
	[side]
		{TOT_SIDE_ENOR}
		recruit=Bowman,Cavalryman,Fencer,Heavy Infantryman,Horseman,Mage,Spearman,Elvish Scout,Elvish Shaman,Elvish Fighter,Elvish Archer,Sword Mage tot,Red Mage,White Mage
		facing=ne
		{QUANTITY gold 150 80 50}
		{QUANTITY income 9 4 1}
	    village_gold=4
		fog=no
	[/side]

	[side]
		{TOT_SIDE_IDLE}
		{UNIT 3 (Walking Corpse) 07 35 (variation=dwarf)}
		{UNIT 3 (Walking Corpse) 09 33 (variation=dwarf)}
		{UNIT 3 (Walking Corpse) 18 29 (variation=dwarf)}
		{UNIT 3 (Walking Corpse) 08 18 (variation=dwarf)}
		{UNIT 3 (Walking Corpse) 10 07 (variation=dwarf)}
		{UNIT 3 (Walking Corpse) 20 05 (variation=dwarf)}
		{UNIT 3 (Walking Corpse) 27 09 (variation=dwarf)}
		{UNIT 3 (Walking Corpse) 25 25 (variation=dwarf)}
		{UNIT 3 (Walking Corpse) 38 29 (variation=dwarf)}
		{UNIT 3 (Soulless) 13 33 (variation=dwarf)}
		{UNIT 3 (Soulless) 19 32 (variation=dwarf)}
		{UNIT 3 (Soulless) 08 23 (variation=dwarf)}
		{UNIT 3 (Soulless) 23 21 (variation=dwarf)}
		{GENERIC_UNIT 3 (Cave Rat) 18 33}
		{GENERIC_UNIT 3 (Cave Rat) 19 35}
		{GENERIC_UNIT 3 (Cave Rat) 22 34}
		{GENERIC_UNIT 3 (Cave Rat) 23 32}
		{GENERIC_UNIT 3 (Cave Rat) 16 30}
		
#ifndef easy
		{UNIT 3 (Soulless) 09 33 (variation=dwarf)}
		{UNIT 3 (Soulless) 14 30 (variation=dwarf)}
		{UNIT 3 (Soulless) 13 28 (variation=dwarf)}
		{UNIT 3 (Soulless) 05 15 (variation=dwarf)}
		{UNIT 3 (Soulless) 13 03 (variation=dwarf)}
		{UNIT 3 (Soulless) 16 06 (variation=dwarf)}
		{UNIT 3 (Soulless) 17 15 (variation=dwarf)}
		{UNIT 3 (Soulless) 32 30 (variation=dwarf)}
		{UNIT 3 (Soulless) 34 26 (variation=dwarf)}
		{UNIT 3 (Soulless) 32 20 (variation=dwarf)}
		{UNIT 3 (Soulless) 33 16 (variation=dwarf)}
		{GENERIC_UNIT 3 (Cave Rat) 20 35}
		{GENERIC_UNIT 3 (Cave Rat) 21 35}
#endif
#ifdef HARD
		{UNIT 3 (Soulless) 15 26 (variation=dwarf)}
		{UNIT 3 (Soulless) 06 19 (variation=dwarf)}
		{UNIT 3 (Soulless) 05 11 (variation=dwarf)}
		{UNIT 3 (Soulless) 07 06 (variation=dwarf)}
		{UNIT 3 (Soulless) 19 04 (variation=dwarf)}
		{UNIT 3 (Soulless) 18 06 (variation=dwarf)}
		{UNIT 3 (Soulless) 28 27 (variation=dwarf)}
		{UNIT 3 (Soulless) 29 21 (variation=dwarf)}
		{GENERIC_UNIT 3 (Cave Rat) 21 31}
		{GENERIC_UNIT 3 (Cave Rat) 19 31}
#endif
		[unit]
			name="Fallen Councillor"
			type="Soulless"
			variation=dwarf
			x,y=8,33
			max_moves=0
			{IS_HERO}
			{TOT_BOSS_STRONG}
		[/unit]
		[unit]
			name="Fallen Councillor"
			type="Soulless"
			variation=dwarf
			x,y=12,35
			max_moves=0
			{IS_HERO}
			{TOT_BOSS_STRONG}
		[/unit]
	[/side]

	[side]
		{TOT_SIDE_WILD}
		{FLAG_VARIANT undead}
		[unit]
			canrecruit=yes
			name="Fallen Lord"
			type="Soulless"
			variation=dwarf
			max_moves=0
			id=undeadDwarfLeader
			x,y=35,14
			[modifications]
				[object]
					#ifdef EASY
						[effect]
							apply_to=hitpoints
							increase_total=75%
						[/effect]
						[effect]
							apply_to=attack
							increase_damage=25%
						[/effect]
					#endif

					#ifdef NORMAL
						[effect]
							apply_to=hitpoints
							increase_total=125%
						[/effect]
						[effect]
							apply_to=attack
							increase_damage=40%
						[/effect]
					#endif

					#ifdef HARD
						[effect]
							apply_to=hitpoints
							increase_total=200%
						[/effect]
						[effect]
							apply_to=attack
							increase_damage=65%
						[/effect]
					#endif
				[/object]
			[/modifications]
		[/unit]

#ifdef EASY
		{GENERIC_UNIT 4 (Revenant) 7 39}
		{GENERIC_UNIT 4 (Skeleton) 18 39}
		{GENERIC_UNIT 4 (Blood Bat) 18 37}
		{GENERIC_UNIT 4 (Vampire Bat) 14 37}
		{GENERIC_UNIT 4 (Vampire Bat) 26 41}
		{GENERIC_UNIT 4 (Vampire Bat) 23 44}
		{GENERIC_UNIT 4 (Revenant) 19 44}
		{GENERIC_UNIT 4 (Skeleton) 5 44}
#endif
#ifdef NORMAL
		{GENERIC_UNIT 4 (Revenant) 7 39}
		{GENERIC_UNIT 4 (Dread Bat) 18 39}
		{GENERIC_UNIT 4 (Blood Bat) 18 37}
		{GENERIC_UNIT 4 (Vampire Bat) 14 37}
		{GENERIC_UNIT 4 (Blood Bat) 26 41}
		{GENERIC_UNIT 4 (Vampire Bat) 23 44}
		{GENERIC_UNIT 4 (Deathblade) 19 44}
		{GENERIC_UNIT 4 (Deathblade) 5 44}
		{GENERIC_UNIT 4 (Skeleton) 3 43}
		{GENERIC_UNIT 4 (Skeleton Archer) 3 42}
		{GENERIC_UNIT 4 (Skeleton Archer) 22 38}
#endif
#ifdef HARD
		{GENERIC_UNIT 4 (Revenant) 7 39}
		{GENERIC_UNIT 4 (Dread Bat) 18 39}
		{GENERIC_UNIT 4 (Dread Bat) 18 37}
		{GENERIC_UNIT 4 (Blood Bat) 14 37}
		{GENERIC_UNIT 4 (Blood Bat) 26 41}
		{GENERIC_UNIT 4 (Blood Bat) 23 44}
		{GENERIC_UNIT 4 (Deathblade) 19 44}
		{GENERIC_UNIT 4 (Deathblade) 5 44}
		{GENERIC_UNIT 4 (Skeleton) 3 43}
		{GENERIC_UNIT 4 (Bone Shooter) 3 42}
		{GENERIC_UNIT 4 (Bone Shooter) 22 38}
		{GENERIC_UNIT 4 (Revenant) 17 38}
#endif
	[/side]


	[side]
#ifdef EASY
        recruit=Soul Seeker
#else
        recruit=Soul Seeker,Soul Wraith
#endif
		controller="ai"
		fog=no
		shroud=no
		hidden=no
		{FLAG_VARIANT6 ragged}
		#ifdef MULTIPLAYER
			{QUANTITY gold 100 200 300}
		#else
			{QUANTITY gold 50 100 150}
		#endif
		no_leader=no
		share_vision="all"
		side=5
		team_name=Enemy
		user_team_name=UndeadSpirits
		income=-2
	[/side]

	[side]
#ifdef EASY
        recruit=Soul Seeker,Dread Bones,Dread Archer,Death Fiend
#else
        recruit=Soul Seeker,Dread Bones,Dread Archer,Sorcerer of the Dead,Death Fiend,Dark Ranger,Dreadrager,Dread Bat
#endif
		controller="ai"
		fog=no
		shroud=no
		hidden=no
		{FLAG_VARIANT6 ragged}
		#ifdef MULTIPLAYER
			{QUANTITY gold 340 430 550}
		#else
			{QUANTITY gold 170 215 275}
		#endif
		no_leader=no
		share_vision="all"
		side=6
		team_name=Enemy
		user_team_name=UndeadLead
		income=-2
	[/side]

	[side]
        recruit=Dread Archer
		controller="ai"
		fog=no
		shroud=no
		hidden=no
		{FLAG_VARIANT6 ragged}
		#ifdef MULTIPLAYER
			{QUANTITY gold 240 300 350}
		#else
			{QUANTITY gold 120 150 175}
		#endif
		no_leader=no
		share_vision="all"
		side=7
		team_name=Enemy
		user_team_name=UndeadArchers
		income=-2
	[/side]

	[side]
        recruit=Dread Bones
		controller="ai"
		fog=no
		shroud=no
		hidden=no
		{FLAG_VARIANT6 ragged}
		#ifdef MULTIPLAYER
			{QUANTITY gold 240 300 350}
		#else
			{QUANTITY gold 120 150 175}
		#endif
		no_leader=no
		share_vision="all"
		side=8
		team_name=Enemy
		user_team_name=UndeadFighters
		income=-2
	[/side]
	[side]
        recruit=Skeleton,Skeleton Archer,Ghost,Wraith,Spectre,Bone Shooter,Banebow,Revenant,Shadow,Draug,Deathblade,Phantom tot
		controller="ai"
		fog=no
		shroud=no
		hidden=no
		{FLAG_VARIANT undead}
		#ifdef MULTIPLAYER
			{QUANTITY gold  500 450 400}
		#else
			{QUANTITY gold 300 270 240}
		#endif
		gold=500
		no_leader=no
		share_vision="all"
		side=9
		team_name=Friendly
		user_team_name=Malin
		income=-2
	[/side]

    [event]
        name=prestart
        {TOT_PETRIFY_IDLE}
		[petrify]
			name="Fallen Lordguard"
		[/petrify]

		[recall]
			id=Middyn
		[/recall]
		[recall]
			id=Dalon
		[/recall]

	    [objectives]
			[objective]
				description= _ "Investigate the magic source from the east"
				condition=win
			[/objective]
			{TOT_DEATH_OBJECTIVE}
	        [objective]
	            description= _ "Death of Middyn or Dalon"
	            condition=lose
	        [/objective]
			[note]
				description= _ "Look around for additional supplies"
			[/note]
			[gold_carryover]
				carryover_percentage=20
			[/gold_carryover]
	    [/objectives]
    [/event]

    [event]
        name=start
		{NARRATE "You and your partner crawl into the mountain's crumbling entrance.."}
		{SAY Leyla "This all looks very unsettling.."}
		{SAY Enor "Hmm.. It doesn't look like a stronghold."}
		{SAY Dalon "Mines.. Perhaps of kin that once dug in these tunnels.. The stronghold shouldn't be far from here."}
		{SAY Middyn "I don't think we will face any more dwarves here, only evil and death."}
		{SAY Enor "Wait.."}
		{SAY Leyla "What is it?"}
		{SAY Enor "Something is wrong.."}
		{SAY_VOICE "... Is that you?.. No.. Someone else.. I feel you.. I.. see now.."}
		{SAY Enor "Who are you!?"}
		{SAY_VOICE "Too long.. Aid me.. And I shall aid you.."}
		{SAY Enor "A necromancer? Did you cause the evil to rise in this stronghold?!"}
		{SAY Leyla "Who are you talking to?"}
		{SAY_VOICE "My power wanes, even now.. You have little time.."}
		{SAY Enor "I can sense an immense amount of magic coming from the east. It is conflicting, I cannot make out exactly what it is. I can also sense dread nearby, the same ones we faced before."}
		{SAY Leyla "I sense a trap.."}
		{SAY Dalon "We can't turn back now, we are surrounded by enemies. There might also be some leftovers we can pick up along the way.. Ahem! For the interest of us all ofcourse.."}
		{SAY Middyn "The dwarf is right. If it is related to the dread, we can put a stop to this madness."}
		{SAY Leyla "Then let us proceed. If anyone is able to vanquish this darkness, it would be us."}
    [/event]

	[event]
		name=sighted
		[filter]
			side=4
		[/filter]
		[filter_second]
			side=1,2
		[/filter_second]
		{SAY second_unit "Undead spotted, be on your guard!"}
	[/event]

	# First dwarf spotted? Let them break loose!
	[event]
		name=sighted
		[filter]
			side=3
			type="Soulless","Walking Corpse"
		[/filter]
		[filter_second]
			side=1,2
		[/filter_second]

		[unpetrify]
			side=3
			type="Soulless","Walking Corpse"
		[/unpetrify]
		[modify_unit]
			[filter]
				side=3
				type="Soulless","Walking Corpse"
			[/filter]
			side=4
		[/modify_unit]
		{SAY Enor "Ah, a keep ahead. We should be able to take it."}
		{SAY Dalon "No, my kin!"}
		{SAY Leyla "We have their attention! Purge them all!"}
		{SAY Dalon "Noooo!"}
	[/event]

	# First cave rat spotted? Let them break loose!
	[event]
		name=sighted
		[filter]
			side=3
			type="Cave Rat"
		[/filter]
		[filter_second]
			side=1,2
		[/filter_second]

		[unpetrify]
			side=3
			type="Cave Rat"
		[/unpetrify]
		[modify_unit]
			[filter]
				side=3
				type="Cave Rat"
			[/filter]
			side=4
		[/modify_unit]
		{SAY second_unit "Rats!"}
		{SAY Leyla "Cave rats. Highly intelligent species."}
		{SAY Enor "And dangerous."}
		{SAY Middyn "Ambush!"}
#ifdef HARD
		{GENERIC_UNIT 4 (Cave Rat) 11 31}
		{GENERIC_UNIT 4 (Cave Rat) 13 32}
		{GENERIC_UNIT 4 (Cave Rat) 11 29}
		{GENERIC_UNIT 4 (Cave Rat) 15 28}
		{GENERIC_UNIT 4 (Cave Rat) 13 26}
#endif
	[/event]

	[event]
		name=turn 20
		[sound]
			name=rumble.ogg
		[/sound]
		{SAY Dalon "That didn't sound good!"}
		{SAY_VOICE "H... Hurry!"}
		{SAY Enor "The voice spoke again, and it is telling us to hurry.."}
		{SAY Leyla "I heard the voice too, we must be getting closer."}
	[/event]

	[event]
		name=attack
		[filter]
			side=1,2
		[/filter]
		[filter_second]
			side=4
			type="Soulless","Walking Corpse"
		[/filter_second]
		{SAY second_unit "Aaaargh! Our gold!"}
	[/event]

	[event]
		name=die
		[filter]
			side=4
			type="Soulless","Walking Corpse"
		[/filter]
		{SAY second_unit "It dropped a map!"}
		{VARIABLE mapCoordsX "$x1"}
		{VARIABLE mapCoordsY "$y1"}
		{TOT_ITEM_TATTERED_MAP $mapCoordsX $mapCoordsY}
	[/event]

	[event]
		name=found map

        {SAY unit "An old map.. I can barely make out the directions. A lot of the tunnels have collapsed too, but we should be able to make out roughly where we are."}
        {NARRATE "Labels of this zone have been added"}

		{MAP_LABEL 10 45 "Southern mountain pass"}
		{SCROLL_TO 10 45}
		{DELAY 500}

		{MAP_LABEL 15 42 "Abandoned southern mine"}
		{SCROLL_TO 15 42}
		{DELAY 500}

		{MAP_LABEL 5 36 "South-western tunnel"}
		{MAP_LABEL 10 34 "Council of Five Hammers"}
		{SCROLL_TO 5 36}
		{DELAY 500}

		{MAP_LABEL 20 32 "Mining site"}
		{SCROLL_TO 20 32}
		{DELAY 500}

		{MAP_LABEL 4 14 "North-western tunnel"}
		{SCROLL_TO 4 14}
		{DELAY 500}

		{MAP_LABEL 16 4 "Mining site"}
		{MAP_LABEL 11 2 "Northern tunnel"}
		{SCROLL_TO 16 4}
		{DELAY 500}

		{MAP_LABEL 29 6 "North-eastern tunnel"}
		{SCROLL_TO 29 6}
		{DELAY 500}

		{MAP_LABEL 23 15 "Dark chasm"}
		{SCROLL_TO 23 15}
		{DELAY 500}

		{MAP_LABEL 28 23 "Abandoned eastern mine"}
		{SCROLL_TO 28 23}
		{DELAY 500}

		{MAP_LABEL 35 32 "Snowy mountain pass"}
		{SCROLL_TO 35 32}
		{DELAY 500}

		{MAP_LABEL 35 16 "Thrones of the Two Lords"}
        {SCROLL_TO 35 16}
		{DELAY 500}

		{SAY Enor "The energy source is coming from east of the Thrones of the Two Lords."}
		{SAY Leyla "Then that is where we're heading."}
	[/event]

	[event]
		name=moveto
		[filter]
			x,y=21,32
			side=1,2
		[/filter]
		{SAY unit "This mine cart contains nothing of interest to us."}
	[/event]
	[event]
		name=moveto
		[filter]
			x,y=9,23
			side=1,2
		[/filter]
		{SAY unit "This mine cart contains nothing of interest to us."}
	[/event]
	[event]
		name=moveto
		[filter]
			x,y=5,14
			side=1,2
		[/filter]
		{SAY unit "This mine cart contains nothing of interest to us."}
	[/event]
	[event]
		name=moveto
		[filter]
			x,y=18,3
			side=1,2
		[/filter]
		{SAY unit "This mine cart contains nothing of interest to us."}
	[/event]
	[event]
		name=moveto
		[filter]
			x,y=18,5
			side=1,2
		[/filter]
		{SAY unit "This minecart is empty."}
	[/event]
	[event]
		name=moveto
		[filter]
			x,y=29,29
			side=1,2
		[/filter]
		{SAY unit "This minecart is empty."}
	[/event]

	[event]
		name=die
		[filter]
			id=spider
		[/filter]
		{UNIT 4 (Giant Spider) 20 6 (
			name="Mother Spider"
			id=SpiderMother
			{TOT_BOSS_STRONG}
		)}
#ifndef EASY
		{GENERIC_UNIT 4 (Giant Spider) 16 2}
		{GENERIC_UNIT 4 (Giant Spider) 20 3}
		{GENERIC_UNIT 4 (Giant Spider) 19 7}
#endif
#ifdef HARD
		{GENERIC_UNIT 4 (Giant Spider) 10 2}
		{GENERIC_UNIT 4 (Giant Spider) 16 6}
		{GENERIC_UNIT 4 (Giant Spider) 9 4}
#endif
		{SAY SpiderMother "Sssssk skktstsstss!" }
		{SAY second_unit "Uh oh.."}
	[/event]

	[event]
		name=turn 4,turn 6,turn 8,turn 10,turn 12,turn 15,turn 20,turn 25,turn 30,turn 38,turn 45
		first_time_only=no
#ifdef EASY
		{GENERIC_UNIT 4 (Ghost) 23 15}
#endif

#ifndef EASY
		{GENERIC_UNIT 4 (Wraith) 24 14}
#endif

#ifdef HARD
		{GENERIC_UNIT 4 (Shadow) 24 15}
#endif
	[/event]

#define ZOMBIE_IN_VILLAGE X Y
	[event]
		name=moveto
		[filter]
			x,y={X},{Y}
			side=1,2
		[/filter]
		{UNIT 4 (Soulless) {X} {Y} (variation=dwarf)}

		[message]
			speaker=narrator
			message= _ "Raaargh!"
			image=portraits/dread/zombie-dwarf.png
		[/message]
	[/event]
#enddef

	{ZOMBIE_IN_VILLAGE 12 27}
	{ZOMBIE_IN_VILLAGE 09 22}
	{ZOMBIE_IN_VILLAGE 07 13}
	{ZOMBIE_IN_VILLAGE 10 03}
	{ZOMBIE_IN_VILLAGE 17 09}
	{ZOMBIE_IN_VILLAGE 29 11}

	[event]
		name=moveto
		[filter]
			x,y=18-32,8-15
			id=Leyla
		[/filter]
		{SAY unit "Flooded.."}
		{SAY Dalon "Hey lass, can't you do anything about this water? Vaporize it or something? My little dwarf legs can't go through there!"}
		{SAY Leyla "I can only assert that whatever caused the collapsing of this stronghold also caused a waterstream to be blocked off. Meaning, I can probably drain some of the water if I can clear the blockage."}
	[/event]

	[event]
		name=moveto
		[filter]
			x,y=21-22,12-13
			id=Leyla
		[/filter]
		{SAY Dalon "I sure hope you know what you're doing!"}
		{SAY Leyla "Don't worry, worst case the entire cave collapses into the chasm and we all die.."}
		{SAY Dalon "Why would you even say that?"}
		{SAY Leyla "Here we go!"}
		{CLEAR_CAVE 21 13}
		{NARRATE "You hear the sounds of water sloshing down the chasm.."}
		{CLEAR_CAVE_QUIETLY 21-22 12}
		{CLEAR_CAVE_QUIETLY 22 10-11}
		{CLEAR_CAVE_QUIETLY 20 10}
		{CLEAR_CAVE_QUIETLY 19-21 11}
		{CLEAR_CAVE_QUIETLY 20 12}
		{CLEAR_CAVE_QUIETLY 19-20 13}
		{CLEAR_CAVE_QUIETLY 18 13}
		{CLEAR_CAVE_QUIETLY 19 14}

		[kill]
			type="Tentacle of the Deep"
			[filter_location]
				[not]
					terrain=Ww,Wo
				[/not]
			[/filter_location]
			animate=yes
			fire_event=yes
		[/kill]

		{SAY Enor "Good work!"}
		[delay]
			time=500
		[/delay]
	[/event]

	[event]
		name=moveto
		[filter]
			x,y=14-15,14
			id=Leyla
		[/filter]
		{CLEAR_CAVE 14 14}
		{CLEAR_CAVE 15 14}
		{NARRATE "You hear the sounds of water sloshing down the chasm.."}
		{CLEAR_CAVE_QUIETLY 16-17 13}
		{CLEAR_CAVE_QUIETLY 16-18 14}
		{CLEAR_CAVE_QUIETLY 14-18 14-15}
		[kill]
			type="Tentacle of the Deep"
			[filter_location]
				[not]
					terrain=Ww,Wo
				[/not]
			[/filter_location]
			animate=yes
			fire_event=yes
		[/kill]
	[/event]

	[event]
		name=moveto
		[filter]
			x,y=19-21,16-17
			id=Leyla
		[/filter]
		{CLEAR_CAVE 21 16}
		[remove_item]
			x,y=21,16
		[/remove_item]
		{NARRATE "You hear the sounds of water sloshing down the chasm.."}
		{CLEAR_CAVE_QUIETLY 19-20 16}
		{CLEAR_CAVE_QUIETLY 14 17}
		{CLEAR_CAVE_QUIETLY 21-22 17}
		{CLEAR_CAVE_QUIETLY 22-23 17-18}
		{CLEAR_CAVE_QUIETLY 24-26 18}
		{CLEAR_CAVE_QUIETLY 25 19}
		{CLEAR_CAVE_QUIETLY 19-20 19}
	    [terrain]
			x,y=21,18
			terrain=Uu
			radius=1
		[/terrain]
	    [terrain]
			x,y=18,17
			terrain=Uu
			radius=1
		[/terrain]
	    [terrain]
			x,y=16,18
			terrain=Uu
			radius=1
		[/terrain]
		[terrain]
			x,y=17-19,20
			terrain=Ww
		[/terrain]
		[terrain]
			x,y=18,19
			terrain=Ww
		[/terrain]
		[terrain]
			x,y=18-19,21
			terrain=Ww
		[/terrain]
		[terrain]
			x,y=22-23,19
			terrain=Ww
		[/terrain]
		[kill]
			type="Tentacle of the Deep"
			[filter_location]
				[not]
					terrain=Ww,Wo
				[/not]
			[/filter_location]
			animate=yes
			fire_event=yes
		[/kill]
		{SAY Leyla "Ah, there we go!?"}
	[/event]
	
	{MOVE_TO 3-7 35-37 (
		{SAY unit "It looks like this tunnel has completely collapsed."}
	)}
	{MOVE_TO 1-4 13-17 (
		{SAY unit "This tunnel looks incredibly unstable, we shouldn't pass through here."}
	)}
	{MOVE_TO 10-12 2-1 (
		{SAY unit "Looks like this tunnel has collapsed as well.."}
	)}
	{MOVE_TO 16-27 18-21 (
		{SAY Leyla "More collapsed tunnels. Looks like we're going through the mines.."}
	)}

	[event]
		name=spottedLordguard
		{SAY unit "Pro..teeect.. the... looord!"}
		{MOVE_TO 33-36 14-18 (
			{SAY undeadDwarfLeader "Kill.. them!"}
			{SAY Leyla "Slay the lord and we shall press on!"}
			{SAY Dalon "Gahh..."}
		)}
	[/event]
	
	[event]
		name=die
		[filter]
			id=undeadDwarfLeader
		[/filter]

		{CANCELMUSIC}
		{TOT_MUSIC_BATTLE}
		{INCIDENTAL_MUSIC (heroes_end.ogg)}

		[terrain]
			x,y=37,14-18
			terrain="^"
			layer=overlay
		[/terrain]
		[modify_side]
			side=5,7,8,9
			{QUANTITY income 20 30 40}
		[/modify_side]
		[modify_side]
			side=6
			{QUANTITY income 30 40 50}
		[/modify_side]
		[modify_side]
			side=9
			{QUANTITY income 70 60 50}
		[/modify_side]
#ifndef HARD
		[unit]
			side=5
			canrecruit=yes
			type="Soul Wraith"
			id=UndeadLeadSpirit
			max_moves=0
			x,y=45,9
			{TOT_BOSS_STRONG}
		[/unit]
#endif
#ifdef HARD
		[unit]
			side=5
			canrecruit=yes
			type="Spectre of Souls"
			id=UndeadLeadSpirit
			max_moves=0
			x,y=45,9
			{TOT_BOSS_STRONG}
		[/unit]
#endif
#ifdef EASY
		[unit]
			side=6
			canrecruit=yes
			type="Deathweaver"
			id=UndeadLeadDoomcaller
			max_moves=0
			x,y=54,32
			{TOT_BOSS_STRONG}
		[/unit]
#endif
#ifndef EASY
		[unit]
			side=6
			canrecruit=yes
			type="Doomcaller"
			id=UndeadLeadDoomcaller
			max_moves=0
			x,y=54,32
			{TOT_BOSS_STRONG}
		[/unit]
#endif

		[unit]
			side=7
			canrecruit=yes
			type="Necro Hunter"
			max_moves=0
			id=UndeadLeadArchers1
			x,y=49,29
			{TOT_BOSS_STRONG}
		[/unit]
		[unit]
			side=7
			canrecruit=yes
			type="Necro Hunter"
			max_moves=0
			id=UndeadLeadArchers2
			x,y=60,29
			{TOT_BOSS_STRONG}
		[/unit]
		[unit]
			side=8
			canrecruit=yes
			type="Dread Commander"
			max_moves=0
			id=UndeadLeadFighters1
			x,y=52,23
			{TOT_BOSS_STRONG}
		[/unit]
		[unit]
			side=8
			canrecruit=yes
			type="Dreadnought"
			max_moves=0
			id=UndeadLeadFighters2
			x,y=56,23
			{TOT_BOSS_STRONG}
		[/unit]
		[unit]
			side=9
			canrecruit=yes
			name="Mal Keshar"
			max_moves=0
			max_experience=500
			type=Weakened Lich
			id=MalinGhost
			x,y=55,16
		[/unit]

		{SAY Enor "The source is close.."}
		{SAY_VOICE "About time.."}
		{SAY Leyla "Show yourself, voice!"}
		{SAY_VOICE "Very well.."}

		[remove_shroud]
			[filter_side]
				side=1,2,9
			[/filter_side]
			x,y=55,16
			radius=9
		[/remove_shroud]

		{SAY MalinGhost "I am Malin Keshar.. Or rather, that is who I used to be. I had once fallen under the weight of collapsed rock and molten lava. Sacrifices had to be made, but it seems my destruction did not mean my end."}
		{SAY Leyla "What do you want?"}
		{SAY MalinGhost "When I fell that day, my physical form could not withstand the amount of pressure enforced upon me. I had one final option, to escape my physical form."}
		{SAY Enor "An ability only very few possess.."}
		{SAY MalinGhost "I am weak, but my soul is in tact."}
		{SAY Leyla "And why should we help you?"}
		{SAY MalinGhost "I suspect that these pretenders of corrupted necromancy seek to take my soul for their own end. I would gladly dispose of them on my own, but my current powers do not allow it."}
		{SAY Enor "So, you expect us to believe a.. lich?.. Er, what exactly are you?"}
		{SAY MalinGhost "You can believe what you like, but I assume we have a common goal. I do not wish to sit here for eons, and you do not wish to meet your end either."}
		{SAY Middyn "It.. He.. is not to be trusted. For whatever we know, he might be controlled by a greater power, to lure us here."}
		{SAY Leyla "Perhaps.. Let us vanquish these dread, then we can see to the Lich."}
		{SAY Dalon "Agreed."}
		{SAY MalinGhost "I will ensure my undead forces do not attack you."}
		{SAY Leyla "You better make sure of that."}
		{SAY Enor "To arms!"}

	    [objectives]
			[objective]
				description= _ "Vanquish the dread army"
				condition=win
			[/objective]
			{TOT_DEATH_OBJECTIVE}
	        [objective]
	            description= _ "Death of Middyn or Dalon"
	            condition=lose
	        [/objective]
	        [objective]
	            description= _ "End of Mal Keshar"
	            condition=lose
	        [/objective]
	    [/objectives]

		[event]
			name=die
			[filter]
				id=MalinGhost
			[/filter]
			[endlevel]
				result=defeat
			[/endlevel]
		[/event]
	[/event]

	[event]
		name=die
		first_time_only=no
		[filter]
			side=5,6,7,8
			id=UndeadLeadSpirit,UndeadLeadArchers1,UndeadLeadArchers2,UndeadLeadFighters1,UndeadLeadFighters2,UndeadLeadDoomcaller
		[/filter]
		{THUNDER ()}
		[if]
			[not]
				[have_unit]
					id=UndeadLeadSpirit,UndeadLeadArchers1,UndeadLeadArchers2,UndeadLeadFighters1,UndeadLeadFighters2,UndeadLeadDoomcaller
				[/have_unit]
			[/not]
			[then]
				{SAY Leyla "Speak, where is your master!? Who sent you!?"}
				{SAY Enor "It is no use, that is the last of the dread for now."}
				{SAY Middyn "Now we see to the lich.."}
				{SAY MalinGhost "Heh, not so fast. This entire stronghold is about to cave in. This was the place of my destruction, and with their power now gone I cannot sustain the heavy rock above and below us.. Let's just say burning alive and being crushed at the same time is a very.. painful transformation."}
				{SAY Dalon "Let me smash its skull in and be done with it!"}
				{SAY MalinGhost "Hilarious thought."}
				{SAY Leyla "No! We're all getting out of here, alive."}
				{SAY Middyn "He's a lich. His destruction means nothing to us."}
				{SAY Leyla "It looked like the dread was trying to get to him, or use his soul like we've seen with the other armies we encountered. He may have answers we need, and we have no other leads at this moment."}
				{SAY Enor "Are you sure that's a good idea?"}
				{SAY Leyla "We have no time to discuss, let's hurry!"}
				{SAY Middyn "Fine."}
				{SAY Enor "Very well."}
				[endlevel]
					result=victory
				[/endlevel]
				{CLEAR_VARIABLE mapCoordsX}
				{CLEAR_VARIABLE mapCoordsY}
			[/then]
		[/if]
	[/event]
[/scenario]